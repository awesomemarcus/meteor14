before_script:
  - export PROJECTFILES="mantraboilerplate.tar.gz"
  - shopt -s expand_aliases
  - alias time="/usr/bin/time -f 'Took %e seconds'"
  - npm config list

cache:
  key: "$CI_BUILD_REF_NAME"
  paths:
      - node_modules

build:
  stage: build
  only:
    - dev
    - prod
  script:
    - time meteor npm install;

test:
  stage: test
  only:
    - dev
    - prod
  script:
    - time eslint .
    - time npm run test
    - time npm run gagarin-build

dev-deploy:
  stage: deploy
  environment: dev
  only:
    - dev
  script:
    - time npm run version;
    - time meteor build . --server-only;
